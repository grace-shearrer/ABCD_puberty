---
title: "TOS2020 4: Models"
output: html_notebook
---
# Aims and Hypotheses
Aim 0. Relationship between testosterone in puberty by obesity and sex
Hyp 0. Testosterone will show a sex by puberty by obesity difference, overall boys will show higher testosterone over puberty with a small nadir at mid point, this will be more pronounced in boys with central obesity. Girls will over all show lower testosterone over puberty, with a slight peak at mid puberty, and again this will be more pronounced in girls with central obesity.

Aim 1. Anticipation vs. Receipt in the brain during the MID by puberty by obesity
Hyp 1. Children with central obesity will show higher anticipation in striatal regions compared to the actual receipt compared to children without central obesity. This will be exaggerated in mid pubertal children

Aim 2. Effect of testosterone on reward vs. no reward between sex by obesity
Hyp 2. Girls with high testosterone will show lower striatal response to reward compared to no reward. Boys on the other hand will show increased response to reward compared to no reward in the stiatum. In the posterior cingulate cortex high testosterone will be related to decreased BOLD response in the reward vs. no reward trials, this will mean that girls will have a diminished BOLD response in the posterior cingulate. In the ventromedial prefrontal cortex, BOLD response in the reward vs. no reward contrast will be inversely related to testosterone concentrations, this will relate to a lower BOLD response in the ventromedial prefrontal cortex in girls. 

```{r}
library(tidyverse)
library(plyr)
library(psych)
library(ggplot2)
library(lm.beta)
library(lme4)
library(emmeans)
```

```{r}
load("~/Google Drive/ABCD/ABCD_puberty/_data/TOS2020/TOS2020_chp3_1.RData")

subcort_<-subset(subcort_RwLsAn, subcort_RwLsAn$central_ob != "central average" & subcort_RwLsAn$central_ob != "central overweight")
summary(as.factor(subcort_$central_ob))
```

# Checking normality
```{r}
hist(data_all$interview_age)
hist(subset(data_all, data_all$gender == "F")$PCSum)
hist(subset(data_all, data_all$gender == "M")$PCSum)
summary(data_all$gender)
# Testosterone
hist(data_all$hormone_scr_ert_mean) # skewed
hist(sqrt(data_all$hormone_scr_ert_mean)) # Better
data_all$sqrt_T<-sqrt(data_all$hormone_scr_ert_mean)
# DHEA
hist(data_all$hormone_scr_dhea_mean) # skewed
hist(sqrt(data_all$hormone_scr_dhea_mean)) # Better
data_all$sqrt_DHEA<-sqrt(data_all$hormone_scr_dhea_mean)
# Estrogen
hist(data_all$hormone_scr_hse_mean) # OK
```

```{r}
mytable <- xtabs(~PCScore+gender+central_ob, data=data_all)
ftable(mytable) # print table
summary(mytable) # chi-square test of indepedence
```

```{r}
mytable <- xtabs(~PCScore+gender, data=data_all)
ftable(mytable) # print table
summary(mytable) # chi-square test of indepedence
```

## Aim 0. Relationship between testosterone in puberty by obesity and sex
## Hyp 0. Testosterone will show a sex by puberty by obesity difference, overall boys will show higher testosterone over puberty with a small nadir at mid point, this will be more pronounced in boys with central obesity. Girls will over all show lower testosterone over puberty, with a slight peak at mid puberty, and again this will be more pronounced in girls with central obesity.

```{r}
mod0.0<-lm(sqrt_T ~ 1+RaceEth+SES+age_years, data=data_all)
summary(mod0.0)
plot(mod0.0)
```

```{r}
summary(data_all$ovob)
mod0.1<-lm(sqrt_T ~PCSum*gender*BMIsds+RaceEth+SES+age_years, data=data_all)
summary(mod0.1)

lm.beta(mod0.1)
plot(mod0.1)
```
# Summary aim 0. No effect of sex, puberty, or obesity on testosterone levels. Only age was related.


### Aim 1. Anticipation vs. Receipt in the brain during the MID by puberty by obesity
### Hyp 1. Children with central obesity will show higher anticipation in striatal regions compared to the actual receipt compared to children without central obesity. This will be exaggerated in mid pubertal children

##### MonetaryIncentiveDelay(MID)
▪ predictors for anticipation of large, small, and no rewards and feedback for large, small, and no rewards for wins and losses
▪ linear contrasts computed for anticipation of large and small reward vs. no reward, anticipation of large and small loss vs. no reward, feedback of win vs. no reward, and feedback of loss vs. no reward

##### anticipation of reward versus neutral contrast mdacrwvsnt
anticipation of large reward versus neutral contrast
anticipation of large reward versus small reward contrast
anticipation of large loss versus neutral contrast
anticipation of small reward versus neutral contrast
anticipation of small loss versus neutral contrast
anticipation of large versus small loss contrast 
anticipation of loss versus neutral contrast

##### reward positive versus negative feedback contrast midrwpvnfkb
loss positive versus negative feedback contrast


### Anticipation vs. Receipt 

#### Caudate model
```{r}
# subcort_RwLsAn$CaudateAntVsRewL
mod1.cL<-lm(CaudateAntVsRewL ~ PCSum*BMIsds*WCsds+RaceEth+SES+age_years+gender+fmri_beta_gparc_mean_motion+scanner_type_pd, data=subcort_)
summary(mod1.cL)

lm.beta(mod1.cL)
plot(mod1.cL)

# PCSum:BMIsds:WCsds significant
```
```{r}
mod1.Rc<-lm(CaudateAntVsRewR ~ PCSum*BMIsds*WCsds+RaceEth+SES+age_years+gender+fmri_beta_gparc_mean_motion+scanner_type_pd, subcort_)
summary(mod1.Rc)

mod1.2Rc<-lm(CaudateAntVsRewR ~ RaceEth+SES+age_years+gender+fmri_beta_gparc_mean_motion+scanner_type_pd, subcort_)
summary(mod1.2Rc)

AIC(mod1.Rc)
AIC(mod1.2Rc)

lm.beta(mod1.Rc)
# plot(mod1.Rc)
# PCSum:BMIsds:WCsds significant 
```
```{r}
mytable <- xtabs(~PCScore+central_ob, data=subcort_)
ftable(mytable) # print table
summary(mytable) # chi-square test of indepedence
```



change_caudate_R?L > 0 ==> reward beta was larger than anticipation
change_caudate_R?L < 0 ==> reward beta was smaller than anticipation
change_caudate_R?L == 0 ==> no difference between anticipation and reward


```{r}
mod1.pL<-lm(PutamenAntVsRewL ~ PCSum*BMIsds*WCsds+RaceEth+SES+age_years+gender+fmri_beta_gparc_mean_motion+scanner_type_pd, data=subcort_)
summary(mod1.pL)

lm.beta(mod1.pL)
plot(mod1.pL)
```


```{r}
mod1.pR<-lm(PutamenAntVsRewR ~ PCSum*BMIsds*WCsds+RaceEth+SES+age_years+gender+fmri_beta_gparc_mean_motion+scanner_type_pd, data=subcort_)
summary(mod1.pR)

lm.beta(mod1.pR)
plot(mod1.pR)
```
# Summary
Compared to the children with an average BMI, children with central obesity show higher response to the anticipation of a reward compared to the receipt of the reward with increasing development in the caudate. This is additionally in contrast to those children with obesity without high waist circumference, who are not different from the average group with increasing development. The effect was not seen in the putamen.

##### Interpretation of 3-way interaction
A three way interaction means that the interaction among the two factors (A x B) is different across the levels of the third factor (C). If the interaction of A x B differs a lot among the levels of C then it sounds reasonable that the two way interaction A x B should not appear as significant. This could be the case of your data.

To put it another way: A two way interaction A x B exists in reality (not statistically) along with a three order interaction A x B x C only if the way that the factors A and B interacts among the levels of the factor C is similar.

So, use a table or an appropriate error chart in order to visualize the way that the interaction of A, B differs between the levels of C and try to interpret those findings.

If you want to emphasize the differences that you will notice then you may apply standard statistical methods (t - test, Kruskal Wallis etc) and confirm the differences with a statistical test. Keep in mind that in that case it is a good idea to make a Bonferroni correction for the rejection level.



### Aim 2. Effect of testosterone on reward vs. no reward between sex by obesity
### Hyp 2. Girls with high testosterone will show lower striatal response to reward compared to no reward. Boys on the other hand will show increased response to reward compared to no reward in the stiatum. In the ** posterior cingulate cortex ** high testosterone will be related to decreased BOLD response in the reward vs. no reward trials, this will mean that girls will have a diminished BOLD response in the posterior cingulate. In the ventromedial prefrontal cortex, BOLD response in the reward vs. no reward contrast will be inversely related to testosterone concentrations, this will relate to a lower BOLD response in the ventromedial prefrontal cortex in girls. 

##### MonetaryIncentiveDelay(MID)
▪ predictors for anticipation of large, small, and no rewards and feedback for large, small, and no rewards for wins and losses
▪ linear contrasts computed for anticipation of large and small reward vs. no reward, anticipation of large and small loss vs. no reward, feedback of win vs. no reward, and feedback of loss vs. no reward

##### anticipation of reward versus neutral contrast mdacrwvsnt
anticipation of large reward versus neutral contrast
anticipation of large reward versus small reward contrast
anticipation of large loss versus neutral contrast
anticipation of small reward versus neutral contrast
anticipation of small loss versus neutral contrast
anticipation of large versus small loss contrast 
anticipation of loss versus neutral contrast

##### reward positive versus negative feedback contrast midrwpvnfkb
loss positive versus negative feedback contrast midlossposvsnegfkbctxlhgp142
reward positive versus negative feedback contrast

```{r}
mod2.cR<-lm(CaudateRewVsLossR ~ hormone_scr_ert_mean*BMIsds*gender+RaceEth+SES+age_years+fmri_beta_gparc_mean_motion+scanner_type_pd, data=subcort_)

summary(mod2.cR)
```

```{r}
mod2.cL<-lm(CaudateRewVsLossL ~ hormone_scr_ert_mean*BMIsds*gender+RaceEth+SES+age_years+fmri_beta_gparc_mean_motion+scanner_type_pd, data=subcort_)

summary(mod2.cL)
```
```{r}
mod2.pR<-lm(PutamenRewVsLossR ~ hormone_scr_ert_mean*BMIsds*gender+RaceEth+SES+age_years+fmri_beta_gparc_mean_motion+scanner_type_pd, data=subcort_)

summary(mod2.pR)
```

```{r}
mod2.pL<-lm(PutamenRewVsLossL ~ hormone_scr_ert_mean*BMIsds*gender+RaceEth+SES+age_years+fmri_beta_gparc_mean_motion+scanner_type_pd, data=subcort_)

summary(mod2.pL)
```
 In the ** posterior cingulate cortex ** high testosterone will be related to decreased BOLD response in the reward vs. no reward trials, this will mean that girls will have a diminished BOLD response in the posterior cingulate.
```{r}
mod2.pcR<-lm(RewVLoss_PC_R ~ hormone_scr_ert_mean*BMIsds*gender+RaceEth+SES+age_years+fmri_beta_gparc_mean_motion+scanner_type_pd, data=RewVsLoss)

summary(mod2.pcR)
```

```{r}
mod2.pcL<-lm(RewVLoss_PC_L ~ hormone_scr_ert_mean*BMIsds*gender+RaceEth+SES+age_years+fmri_beta_gparc_mean_motion+scanner_type_pd, data=RewVsLoss)

summary(mod2.pcL)
``` 
```{r}
mod2.vmR<-lm(RewVLoss_VMPF_R ~ hormone_scr_ert_mean*BMIsds*gender+RaceEth+SES+age_years+fmri_beta_gparc_mean_motion+scanner_type_pd, data=RewVsLoss)

summary(mod2.vmR)
``` 

```{r}
mod2.vmL<-lm(RewVLoss_VMPF_L ~ hormone_scr_ert_mean*BMIsds*gender+RaceEth+SES+age_years+fmri_beta_gparc_mean_motion+scanner_type_pd, data=RewVsLoss)

summary(mod2.vmL)
``` 
# Summary of aim 2. Threeway interaction between testosterone, sex, and BMI in the caudate only. No effect in the ventromedial prefrontal cortex, the putamen, nor the posterior cingulate. 



